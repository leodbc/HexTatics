<!DOCTYPE html>
<html lang="pt-BR">
<!-- MVP PRONTO -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description"
        content="HexTatics ‚Äî Puzzle hexagonal estrat√©gico. Remova pe√ßas respeitando regras de cor!">
    <meta name="theme-color" content="#0f0f1a">
    <title>HexTatics ‚Äî Puzzle Hexagonal</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Tela de Boas-Vindas -->
    <div id="welcome-screen">
        <span class="hex-deco top-left">‚¨°</span>
        <span class="hex-deco bot-right">‚¨°</span>
        <h1>HexTatics</h1>
        <p class="subtitle">Puzzle Hexagonal Estrat√©gico</p>
        <div class="welcome-stats" id="welcome-stats" style="display:none;">
            <div class="welcome-progress-bar">
                <div class="welcome-progress-fill" id="welcome-progress-fill"></div>
            </div>
            <span id="welcome-progress-text"></span>
        </div>
        <button class="btn-tutorial" id="btn-tutorial">üìñ Tutorial</button>
        <button class="btn-play" id="btn-start">‚ñ∂ Jogar</button>
        <button class="btn-tutorial" id="btn-maps">üåç Mapas</button>
        <button class="btn-continue" id="btn-continue" style="display:none;">‚ñ∂ Continuar</button>
        <button class="btn-editor-welcome" id="btn-editor-welcome">üîß Criar Mapa</button>
    </div>

    <!-- Comunidade de Mapas -->
    <div id="community-screen" style="display:none;">
        <h2>üåç Mapas da Comunidade</h2>
        <div class="community-tabs">
            <button class="btn community-tab active" id="community-tab-recent" data-tab="recent">Recentes</button>
            <button class="btn community-tab" id="community-tab-hot" data-tab="hot">Em Alta</button>
            <button class="btn community-tab" id="community-tab-mine" data-tab="mine">Meus Mapas</button>
        </div>
        <div class="community-content" id="community-content">
            <div class="loading" id="community-loading" style="display:none;">Carregando mapas...</div>
            <div class="error-state" id="community-error" style="display:none;">
                <div>‚ö†Ô∏è N√£o foi poss√≠vel carregar. Tente novamente.</div>
                <button class="btn" id="community-retry">Tentar novamente</button>
            </div>
            <div class="empty-state" id="community-empty" style="display:none;">üó∫Ô∏è Nenhum mapa encontrado ainda. Seja o
                primeiro!</div>
            <div class="community-grid" id="community-grid"></div>
        </div>
        <div class="community-actions">
            <button class="btn" id="community-load-more" style="display:none;">Carregar mais</button>
            <button class="btn" id="community-back">‚Üê Voltar</button>
        </div>
    </div>

    <!-- HUD Superior (Jogo) -->
    <div id="hud" style="display:none;">
        <div class="hud-left">
            <span id="level-name">Fase 1</span>
        </div>
        <div class="hud-center">
            <span id="move-counter">0</span>
            <span id="piece-counter" class="piece-counter"></span>
            <span id="level-timer" class="timer-badge">0:00</span>
        </div>
        <div class="hud-right">
            <button class="btn btn-icon btn-editor-hud" id="btn-editor-hud" style="display:none;"
                title="Voltar ao Editor">üîß</button>
            <button class="btn btn-icon btn-undo" id="btn-undo" title="Desfazer (Ctrl+Z)">‚ü≤</button>
            <button class="btn btn-icon btn-pause" id="btn-pause" title="Pausar">‚è∏</button>
        </div>
    </div>

    <!-- HUD Superior (Editor) -->
    <div id="editor-hud" style="display:none;">
        <div class="hud-left">
            <button class="btn btn-icon" id="editor-back" title="Voltar">‚Üê</button>
            <input type="text" id="editor-name" value="Minha Fase" placeholder="Nome da fase" class="editor-name-input">
        </div>
        <div class="hud-center">
            <span class="editor-size-label">Grade:</span>
            <button class="btn btn-icon btn-tiny" id="editor-cols-minus">‚àí</button>
            <span id="editor-cols-val" class="editor-size-val">7</span>
            <button class="btn btn-icon btn-tiny" id="editor-cols-plus">+</button>
            <span class="editor-sep">√ó</span>
            <button class="btn btn-icon btn-tiny" id="editor-rows-minus">‚àí</button>
            <span id="editor-rows-val" class="editor-size-val">6</span>
            <button class="btn btn-icon btn-tiny" id="editor-rows-plus">+</button>
        </div>
        <div class="hud-right">
            <span id="editor-piece-count" class="editor-count">0 pe√ßas</span>
            <button class="btn btn-icon btn-reset" id="editor-clear" title="Limpar tudo">üóëÔ∏è</button>
        </div>
    </div>

    <!-- √Årea do Jogo / Editor (compartilhada) -->
    <div id="game-area">
        <canvas id="game-canvas"></canvas>

        <div id="tutorial-overlay">
            <div id="tutorial-wizard" style="display:none;">
                <div class="tutorial-wizard-head">
                    <span id="tutorial-step-badge">Wizard Onboarding</span>
                    <span id="tutorial-step-progress">1/1</span>
                </div>
                <h3 id="tutorial-step-title"></h3>
                <p id="tutorial-step-text"></p>
                <div id="tutorial-step-rule" class="tutorial-step-rule"></div>
                <div id="tutorial-step-objective" class="tutorial-step-objective"></div>
                <div class="tutorial-wizard-actions">
                    <button class="btn" id="tutorial-prev">‚Üê Anterior</button>
                    <button class="btn" id="tutorial-skip">Pular</button>
                    <button class="btn btn-accent" id="tutorial-next">Pr√≥ximo ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="status-message"></div>
    </div>

    <!-- M√£o do Jogador (Jogo) -->
    <div id="hand-area" style="display:none;">
        <span id="hand-label">M√£o: vazia</span>
        <div id="hand-pieces"></div>
    </div>

    <!-- Toolbar do Editor -->
    <div id="editor-toolbar" style="display:none;">
        <div class="editor-tools">
            <div class="editor-section">
                <button class="editor-tool active" data-tool="red" title="Vermelha ‚ô¶"><span class="tool-swatch"
                        style="background:#DD2222;"></span></button>
                <button class="editor-tool" data-tool="blue" title="Azul ‚óè"><span class="tool-swatch"
                        style="background:#2244CC;"></span></button>
                <button class="editor-tool" data-tool="green" title="Verde ‚ñ†"><span class="tool-swatch"
                        style="background:#22AA22;"></span></button>
                <button class="editor-tool" data-tool="orange" title="Laranja ‚¨ü"><span class="tool-swatch"
                        style="background:#E67E22;"></span></button>
                <button class="editor-tool" data-tool="yellow" title="Amarela ‚ñ≤"><span class="tool-swatch"
                        style="background:#EECC00;"></span></button>
                <button class="editor-tool" data-tool="purple" title="Roxa ‚ú¶"><span class="tool-swatch"
                        style="background:#9933CC;"></span></button>
                <button class="editor-tool" data-tool="white" title="Branca ‚óâ"><span class="tool-swatch"
                        style="background:#F2F2F2;"></span></button>
                <button class="editor-tool" data-tool="gray" title="Cinza ‚ñ¨"><span class="tool-swatch"
                        style="background:#999;"></span></button>
                <button class="editor-tool" data-tool="black" title="Preta ‚¨¢"><span class="tool-swatch"
                        style="background:#111;"></span></button>
                <span class="editor-divider"></span>
                <button class="editor-tool" data-tool="eraser" title="Apagar pe√ßa">üßπ</button>
                <button class="editor-tool" data-tool="toggle" title="Criar/remover buraco">üï≥Ô∏è</button>
                <button class="editor-tool" data-tool="modifier" title="Adicionar modificador">üîÑ</button>
            </div>
            <div class="editor-mod-palette" id="editor-mod-palette" style="display:none;">
                <span class="editor-mod-label">Mod:</span>
                <button class="editor-mod active" data-mod="red"><span class="mod-dot"
                        style="background:#DD2222;"></span></button>
                <button class="editor-mod" data-mod="blue"><span class="mod-dot"
                        style="background:#2244CC;"></span></button>
                <button class="editor-mod" data-mod="green"><span class="mod-dot"
                        style="background:#22AA22;"></span></button>
                <button class="editor-mod" data-mod="orange"><span class="mod-dot"
                        style="background:#E67E22;"></span></button>
                <button class="editor-mod" data-mod="yellow"><span class="mod-dot"
                        style="background:#EECC00;"></span></button>
                <button class="editor-mod" data-mod="purple"><span class="mod-dot"
                        style="background:#9933CC;"></span></button>
                <button class="editor-mod" data-mod="white"><span class="mod-dot"
                        style="background:#F2F2F2;"></span></button>
                <button class="editor-mod" data-mod="gray"><span class="mod-dot"
                        style="background:#999;"></span></button>
                <button class="editor-mod" data-mod="black"><span class="mod-dot"
                        style="background:#111;"></span></button>
            </div>
        </div>
        <div class="editor-actions">
            <div class="editor-settings">
                <label>Limite: <input type="number" id="editor-move-limit" min="0" max="99" value="" placeholder="‚àû"
                        class="editor-num-input"></label>
                <label>Par: <input type="number" id="editor-par" min="1" max="99" value="" placeholder="auto"
                        class="editor-num-input"></label>
            </div>
            <div class="editor-buttons">
                <button class="btn btn-accent" id="editor-test">Testar</button>
                <button class="btn" id="editor-save">Salvar</button>
                <button class="btn" id="editor-publish">Publicar</button>
                <button class="btn" id="editor-export">Exportar</button>
                <button class="btn" id="editor-import">Importar</button>
            </div>
        </div>

    </div>

    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas"></canvas>

    <!-- Overlay -->
    <div id="overlay">
        <!-- Pause Menu Modal -->
        <div class="modal pause-menu" id="pause-modal" style="display:none;">
            <h2>‚è∏ Pausado</h2>
            <div id="pause-level-info" class="pause-level-info"></div>
            <div class="pause-actions">
                <button class="btn btn-accent btn-large" id="btn-resume">‚ñ∂ Continuar</button>
                <button class="btn" id="btn-restart-pause">‚Ü∫ Reiniciar Fase</button>
                <button class="btn" id="btn-levels-pause">‚ò∞ Selecionar Fase</button>
                <button class="btn" id="btn-help-pause">‚ùì Ver Regras</button>
                <button class="btn btn-home" id="btn-home">üè† Menu Inicial</button>
            </div>
        </div>

        <!-- Win Modal -->
        <div class="modal win" id="win-modal" style="display:none;">
            <div class="win-header">
                <h2>üéâ Fase Completa!</h2>
            </div>
            <div class="win-level-name" id="win-level-name"></div>
            <div class="stars" id="win-stars"></div>
            <div class="win-stats">
                <div class="win-stat">
                    <div class="win-stat-value" id="win-moves">0</div>
                    <div class="win-stat-label">Movimentos</div>
                </div>
                <div class="win-stat">
                    <div class="win-stat-value" id="win-par">0</div>
                    <div class="win-stat-label">Par</div>
                </div>
                <div class="win-stat">
                    <div class="win-stat-value" id="win-time">0:00</div>
                    <div class="win-stat-label">Tempo</div>
                </div>
            </div>
            <div id="win-best-msg" class="win-best-msg"></div>
            <div class="win-actions">
                <button class="btn btn-accent btn-large" id="btn-next-level">Pr√≥xima Fase ‚Üí</button>
                <div class="win-secondary">
                    <button class="btn" id="btn-replay">‚Ü∫ Jogar Novamente</button>
                    <button class="btn" id="btn-levels-win">‚ò∞ Fases</button>
                    <button class="btn" id="btn-like-map" style="display:none;">‚ù§Ô∏è Curtir</button>
                    <button class="btn" id="btn-publish-win" style="display:none;">üì§ Publicar na Comunidade</button>
                    <button class="btn" id="btn-back-editor" style="display:none;">üîß Voltar ao Editor</button>
                </div>
            </div>
        </div>

        <!-- Game Complete Modal -->
        <div class="modal game-complete" id="game-complete-modal" style="display:none;">
            <h2>üèÜ Mestre Supremo! üèÜ</h2>
            <p class="game-complete-sub">Voc√™ completou todas as fases do HexTatics!</p>
            <div class="stars total-stars" id="total-stars"></div>
            <div class="game-complete-stats"><span id="total-stars-text"></span></div>
            <div class="win-actions">
                <button class="btn btn-accent btn-large" id="btn-replay-all">‚Ü∫ Jogar Tudo de Novo</button>
                <button class="btn" id="btn-levels-complete">‚ò∞ Ver Fases</button>
            </div>
        </div>

        <!-- Lose Modal -->
        <div class="modal lose" id="lose-modal" style="display:none;">
            <h2>‚õî Limite de Movimentos!</h2>
            <p>Voc√™ excedeu o limite. Tente uma abordagem diferente!</p>
            <div class="lose-actions">
                <button class="btn btn-accent" id="btn-undo-lose">‚ü≤ Desfazer √öltimo</button>
                <button class="btn btn-reset" id="btn-reset-lose">‚Ü∫ Reiniciar</button>
                <button class="btn" id="btn-levels-lose">‚ò∞ Fases</button>
            </div>
        </div>

        <!-- Level Select Modal -->
        <div class="modal level-select" id="level-select-modal" style="display:none;">
            <h2>üìã Selecione uma Fase</h2>
            <div class="level-progress" id="level-progress">
                <div class="level-progress-bar">
                    <div class="level-progress-fill" id="level-progress-fill"></div>
                </div>
                <span id="level-progress-text"></span>
            </div>
            <div class="level-grid" id="level-grid"></div>
            <div id="custom-levels-section" style="display:none;">
                <h3 class="custom-section-title">üîß Fases Personalizadas</h3>
                <div class="level-grid" id="custom-level-grid"></div>
            </div>
            <div class="level-select-actions">
                <button class="btn" id="btn-open-editor-from-levels">üîß Criar Fase</button>
                <button class="btn" id="btn-close-levels">‚úï Fechar</button>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="modal" id="help-modal" style="display:none;">
            <h2>üìñ Regras do Jogo</h2>
            <p>Remova todas as pe√ßas do tabuleiro! Cada cor tem sua regra:</p>
            <div class="rules-grid">
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#CC2222;">‚ô¶</div>
                    <div class="rule-text"><strong>Vermelha</strong><br>1+ vizinhas (ignora pretas), mas n√£o todas.
                    </div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#2244BB;">‚óè</div>
                    <div class="rule-text"><strong>Azul</strong><br>Remove s√≥ com 0 vizinhas (ignora pretas).</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#1D8C1D;">‚ñ†</div>
                    <div class="rule-text"><strong>Verde</strong><br>Remove com 2+ vizinhas que formam grupo adjacente.
                    </div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#E67E22;">‚¨ü</div>
                    <div class="rule-text"><strong>Laranja</strong><br>Remove quando TODAS as casas adjacentes est√£o
                        preenchidas.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#CCAA00;">‚ñ≤</div>
                    <div class="rule-text"><strong>Amarela</strong><br>Exatamente 3 vizinhas sem pares opostos (ignora
                        pretas).</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#9933CC;">‚ú¶</div>
                    <div class="rule-text"><strong>Roxa</strong><br>Exatamente 2 vizinhas opostas (ignora pretas).</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#F2F2F2; color:#222;">‚óâ</div>
                    <div class="rule-text"><strong>Branca</strong><br>Remove s√≥ se sua m√£o n√£o tiver pe√ßas de outras
                        cores.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#666;">‚ñ¨</div>
                    <div class="rule-text"><strong>Cinza</strong><br>Copia regra + modificador da √∫ltima pe√ßa removida.
                    </div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#111;">‚¨¢</div>
                    <div class="rule-text"><strong>Preta</strong><br>Parede im√≥vel: remove s√≥ quando restarem apenas
                        pretas.</div>
                </div>
            </div>
            <div class="help-extras">
                <p>üîÑ <strong>Modificadores:</strong> C√≠rculo colorido = regra usa aquela cor como refer√™ncia.</p>
                <p>üñêÔ∏è <strong>M√£o:</strong> Pe√ßas removidas v√£o para sua m√£o. Clique para recolocar.</p>
                <p>‚Ü©Ô∏è <strong>Undo:</strong> Ctrl+Z ou bot√£o ‚ü≤</p>
            </div>
            <button class="btn" id="btn-close-help">‚úï Fechar</button>
        </div>

        <!-- Publish Modal -->
        <div class="modal publish-modal" id="publish-modal" style="display:none;">
            <h2>üì§ Publicar na Comunidade</h2>
            <p id="publish-preview"></p>
            <label>Nickname (opcional)
                <input type="text" id="publish-author" maxlength="20" placeholder="An√¥nimo" class="editor-name-input">
            </label>
            <div class="level-select-actions">
                <button class="btn btn-accent" id="publish-confirm">Publicar</button>
                <button class="btn" id="publish-cancel">Cancelar</button>
            </div>
        </div>

        <!-- Export Modal -->
        <div class="modal" id="export-modal" style="display:none;">
            <h2>Exportar Fase</h2>
            <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:12px;">
                <button class="btn btn-accent" id="export-json-btn">Exportar como JSON</button>
                <button class="btn btn-accent" id="export-code-btn">Exportar como C√≥digo (HEX)</button>
            </div>
            <p style="color:var(--text-dim);font-size:0.9em;margin-top:12px;text-align:center;">Ao clicar, o conte√∫do ser√° copiado para a √°rea de transfer√™ncia.</p>
        </div>

        <!-- Import Modal -->
        <div class="modal" id="import-modal" style="display:none;">
            <h2>Importar Fase</h2>
            <p>Cole aqui o c√≥digo HEX ou JSON da fase:</p>
            <textarea id="import-textarea" style="width:100%;height:160px;margin-top:12px;resize:vertical;"></textarea>
            <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end;">
                <button class="btn btn-accent" id="import-confirm-btn">Importar</button>
                <button class="btn" id="import-cancel-btn">Cancelar</button>
            </div>
        </div>

        <!-- Report Modal -->
        <div class="modal" id="report-modal" style="display:none;">
            <h2>üö© Denunciar mapa</h2>
            <select id="report-reason" class="editor-name-input" style="width:100%;">
                <option value="spam">Spam</option>
                <option value="inappropriate">Inapropriado</option>
                <option value="impossible">Imposs√≠vel</option>
                <option value="other">Outro</option>
            </select>
            <label>Detalhes (opcional)
                <input type="text" id="report-detail" maxlength="120" class="editor-name-input" style="width:100%;"
                    placeholder="Descreva rapidamente">
            </label>
            <div class="level-select-actions">
                <button class="btn btn-accent" id="report-confirm">Enviar den√∫ncia</button>
                <button class="btn" id="report-cancel">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="levels.js"></script>
    <script src="game.js"></script>
    <script src="renderer.js"></script>
    <script src="solver.js"></script>
    <script src="editor.js"></script>
    <script src="tutorial_wizard.js"></script>
    <script src="api.js"></script>
    <script>
        window.COMMUNITY_ENABLED = true;
        window.COMMUNITY_API_BASE = "https://qxontsndhwvwwhvneqmc.functions.supabase.co";
    </script>
    <script src="app.js"></script>
</body>

</html>