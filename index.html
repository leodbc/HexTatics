<!DOCTYPE html>
<html lang="pt-BR">
    <!-- MVP PRONTO -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description"
        content="HexTatics â€” Puzzle hexagonal estratÃ©gico. Remova peÃ§as respeitando regras de cor!">
    <meta name="theme-color" content="#0f0f1a">
    <title>HexTatics â€” Puzzle Hexagonal</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Tela de Boas-Vindas -->
    <div id="welcome-screen">
        <span class="hex-deco top-left">â¬¡</span>
        <span class="hex-deco bot-right">â¬¡</span>
        <h1>HexTatics</h1>
        <p class="subtitle">Puzzle Hexagonal EstratÃ©gico</p>
        <div class="welcome-stats" id="welcome-stats" style="display:none;">
            <div class="welcome-progress-bar">
                <div class="welcome-progress-fill" id="welcome-progress-fill"></div>
            </div>
            <span id="welcome-progress-text"></span>
        </div>
        <button class="btn-tutorial" id="btn-tutorial">ğŸ“– Tutorial</button>
        <button class="btn-play" id="btn-start">â–¶ Jogar</button>
        <button class="btn-tutorial" id="btn-maps">ğŸŒ Mapas</button>
        <button class="btn-continue" id="btn-continue" style="display:none;">â–¶ Continuar</button>
        <button class="btn-editor-welcome" id="btn-editor-welcome">ğŸ”§ Criar Fase</button>
    </div>

    <!-- Comunidade de Mapas -->
    <div id="community-screen" style="display:none;">
        <h2>ğŸŒ Mapas da Comunidade</h2>
        <div class="community-tabs">
            <button class="btn community-tab active" id="community-tab-recent" data-tab="recent">Recentes</button>
            <button class="btn community-tab" id="community-tab-hot" data-tab="hot">Em Alta</button>
        </div>
        <div class="community-content" id="community-content">
            <div class="loading" id="community-loading" style="display:none;">Carregando mapas...</div>
            <div class="error-state" id="community-error" style="display:none;">
                <div>âš ï¸ NÃ£o foi possÃ­vel carregar. Tente novamente.</div>
                <button class="btn" id="community-retry">Tentar novamente</button>
            </div>
            <div class="empty-state" id="community-empty" style="display:none;">ğŸ—ºï¸ Nenhum mapa encontrado ainda. Seja o primeiro!</div>
            <div class="community-grid" id="community-grid"></div>
        </div>
        <div class="community-actions">
            <button class="btn" id="community-load-more" style="display:none;">Carregar mais</button>
            <button class="btn" id="community-back">â† Voltar</button>
        </div>
    </div>

    <!-- HUD Superior (Jogo) -->
    <div id="hud" style="display:none;">
        <div class="hud-left">
            <span id="level-name">Fase 1</span>
        </div>
        <div class="hud-center">
            <span id="move-counter">0</span>
            <span id="piece-counter" class="piece-counter"></span>
            <span id="level-timer" class="timer-badge">0:00</span>
        </div>
        <div class="hud-right">
            <button class="btn btn-icon btn-editor-hud" id="btn-editor-hud" style="display:none;" title="Voltar ao Editor">ğŸ”§</button>
            <button class="btn btn-icon btn-undo" id="btn-undo" title="Desfazer (Ctrl+Z)">âŸ²</button>
            <button class="btn btn-icon btn-pause" id="btn-pause" title="Pausar">â¸</button>
        </div>
    </div>

    <!-- HUD Superior (Editor) -->
    <div id="editor-hud" style="display:none;">
        <div class="hud-left">
            <button class="btn btn-icon" id="editor-back" title="Voltar">â†</button>
            <input type="text" id="editor-name" value="Minha Fase" placeholder="Nome da fase" class="editor-name-input">
        </div>
        <div class="hud-center">
            <span class="editor-size-label">Grade:</span>
            <button class="btn btn-icon btn-tiny" id="editor-cols-minus">âˆ’</button>
            <span id="editor-cols-val" class="editor-size-val">7</span>
            <button class="btn btn-icon btn-tiny" id="editor-cols-plus">+</button>
            <span class="editor-sep">Ã—</span>
            <button class="btn btn-icon btn-tiny" id="editor-rows-minus">âˆ’</button>
            <span id="editor-rows-val" class="editor-size-val">6</span>
            <button class="btn btn-icon btn-tiny" id="editor-rows-plus">+</button>
        </div>
        <div class="hud-right">
            <span id="editor-piece-count" class="editor-count">0 peÃ§as</span>
            <button class="btn btn-icon btn-reset" id="editor-clear" title="Limpar tudo">ğŸ—‘ï¸</button>
        </div>
    </div>

    <!-- Ãrea do Jogo / Editor (compartilhada) -->
    <div id="game-area">
        <canvas id="game-canvas"></canvas>

        <div id="tutorial-overlay">
            <div id="tutorial-wizard" style="display:none;">
                <div class="tutorial-wizard-head">
                    <span id="tutorial-step-badge">Wizard Onboarding</span>
                    <span id="tutorial-step-progress">1/1</span>
                </div>
                <h3 id="tutorial-step-title"></h3>
                <p id="tutorial-step-text"></p>
                <div id="tutorial-step-rule" class="tutorial-step-rule"></div>
                <div id="tutorial-step-objective" class="tutorial-step-objective"></div>
                <div class="tutorial-wizard-actions">
                    <button class="btn" id="tutorial-prev">â† Anterior</button>
                    <button class="btn" id="tutorial-skip">Pular</button>
                    <button class="btn btn-accent" id="tutorial-next">PrÃ³ximo â†’</button>
                </div>
            </div>
        </div>

        <div id="status-message"></div>
    </div>

    <!-- MÃ£o do Jogador (Jogo) -->
    <div id="hand-area" style="display:none;">
        <span id="hand-label">MÃ£o: vazia</span>
        <div id="hand-pieces"></div>
    </div>

    <!-- Toolbar do Editor -->
    <div id="editor-toolbar" style="display:none;">
        <div class="editor-tools">
            <div class="editor-section">
                <button class="editor-tool active" data-tool="red" title="Vermelha â™¦"><span class="tool-swatch" style="background:#DD2222;"></span></button>
                <button class="editor-tool" data-tool="blue" title="Azul â—"><span class="tool-swatch" style="background:#2244CC;"></span></button>
                <button class="editor-tool" data-tool="green" title="Verde â– "><span class="tool-swatch" style="background:#22AA22;"></span></button>
                <button class="editor-tool" data-tool="orange" title="Laranja â¬Ÿ"><span class="tool-swatch" style="background:#E67E22;"></span></button>
                <button class="editor-tool" data-tool="yellow" title="Amarela â–²"><span class="tool-swatch" style="background:#EECC00;"></span></button>
                <button class="editor-tool" data-tool="purple" title="Roxa âœ¦"><span class="tool-swatch" style="background:#9933CC;"></span></button>
                <button class="editor-tool" data-tool="white" title="Branca â—‰"><span class="tool-swatch" style="background:#F2F2F2;"></span></button>
                <button class="editor-tool" data-tool="gray" title="Cinza â–¬"><span class="tool-swatch" style="background:#999;"></span></button>
                <button class="editor-tool" data-tool="black" title="Preta â¬¢"><span class="tool-swatch" style="background:#111;"></span></button>
                <span class="editor-divider"></span>
                <button class="editor-tool" data-tool="eraser" title="Apagar peÃ§a">ğŸ§¹</button>
                <button class="editor-tool" data-tool="toggle" title="Criar/remover buraco">ğŸ•³ï¸</button>
                <button class="editor-tool" data-tool="modifier" title="Adicionar modificador">ğŸ”„</button>
            </div>
            <div class="editor-mod-palette" id="editor-mod-palette" style="display:none;">
                <span class="editor-mod-label">Mod:</span>
                <button class="editor-mod active" data-mod="red"><span class="mod-dot" style="background:#DD2222;"></span></button>
                <button class="editor-mod" data-mod="blue"><span class="mod-dot" style="background:#2244CC;"></span></button>
                <button class="editor-mod" data-mod="green"><span class="mod-dot" style="background:#22AA22;"></span></button>
                <button class="editor-mod" data-mod="orange"><span class="mod-dot" style="background:#E67E22;"></span></button>
                <button class="editor-mod" data-mod="yellow"><span class="mod-dot" style="background:#EECC00;"></span></button>
                <button class="editor-mod" data-mod="purple"><span class="mod-dot" style="background:#9933CC;"></span></button>
                <button class="editor-mod" data-mod="white"><span class="mod-dot" style="background:#F2F2F2;"></span></button>
                <button class="editor-mod" data-mod="gray"><span class="mod-dot" style="background:#999;"></span></button>
                <button class="editor-mod" data-mod="black"><span class="mod-dot" style="background:#111;"></span></button>
            </div>
        </div>
        <div class="editor-actions">
            <div class="editor-settings">
                <label>Limite: <input type="number" id="editor-move-limit" min="0" max="99" value="" placeholder="âˆ" class="editor-num-input"></label>
                <label>Par: <input type="number" id="editor-par" min="1" max="99" value="" placeholder="auto" class="editor-num-input"></label>
            </div>
            <div class="editor-buttons">
                <button class="btn btn-accent" id="editor-test">â–¶ Testar</button>
                <button class="btn" id="editor-save">ğŸ’¾ Salvar</button>
                <button class="btn" id="editor-publish">ğŸ“¤ Publicar</button>
                <button class="btn" id="editor-export">ğŸ“¤</button>
                <button class="btn" id="editor-import">ğŸ“¥</button>
            </div>
        </div>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas"></canvas>

    <!-- Overlay -->
    <div id="overlay">
        <!-- Pause Menu Modal -->
        <div class="modal pause-menu" id="pause-modal" style="display:none;">
            <h2>â¸ Pausado</h2>
            <div id="pause-level-info" class="pause-level-info"></div>
            <div class="pause-actions">
                <button class="btn btn-accent btn-large" id="btn-resume">â–¶ Continuar</button>
                <button class="btn" id="btn-restart-pause">â†º Reiniciar Fase</button>
                <button class="btn" id="btn-levels-pause">â˜° Selecionar Fase</button>
                <button class="btn" id="btn-help-pause">â“ Ver Regras</button>
                <button class="btn btn-home" id="btn-home">ğŸ  Menu Inicial</button>
            </div>
        </div>

        <!-- Win Modal -->
        <div class="modal win" id="win-modal" style="display:none;">
            <div class="win-header">
                <h2>ğŸ‰ Fase Completa!</h2>
            </div>
            <div class="win-level-name" id="win-level-name"></div>
            <div class="stars" id="win-stars"></div>
            <div class="win-stats">
                <div class="win-stat">
                    <div class="win-stat-value" id="win-moves">0</div>
                    <div class="win-stat-label">Movimentos</div>
                </div>
                <div class="win-stat">
                    <div class="win-stat-value" id="win-par">0</div>
                    <div class="win-stat-label">Par</div>
                </div>
                <div class="win-stat">
                    <div class="win-stat-value" id="win-time">0:00</div>
                    <div class="win-stat-label">Tempo</div>
                </div>
            </div>
            <div id="win-best-msg" class="win-best-msg"></div>
            <div class="win-actions">
                <button class="btn btn-accent btn-large" id="btn-next-level">PrÃ³xima Fase â†’</button>
                <div class="win-secondary">
                    <button class="btn" id="btn-replay">â†º Jogar Novamente</button>
                    <button class="btn" id="btn-levels-win">â˜° Fases</button>
                    <button class="btn" id="btn-like-map" style="display:none;">â¤ï¸ Curtir</button>
                    <button class="btn" id="btn-publish-win" style="display:none;">ğŸ“¤ Publicar na Comunidade</button>
                    <button class="btn" id="btn-back-editor" style="display:none;">ğŸ”§ Voltar ao Editor</button>
                </div>
            </div>
        </div>

        <!-- Game Complete Modal -->
        <div class="modal game-complete" id="game-complete-modal" style="display:none;">
            <h2>ğŸ† Mestre Supremo! ğŸ†</h2>
            <p class="game-complete-sub">VocÃª completou todas as fases do HexTatics!</p>
            <div class="stars total-stars" id="total-stars"></div>
            <div class="game-complete-stats"><span id="total-stars-text"></span></div>
            <div class="win-actions">
                <button class="btn btn-accent btn-large" id="btn-replay-all">â†º Jogar Tudo de Novo</button>
                <button class="btn" id="btn-levels-complete">â˜° Ver Fases</button>
            </div>
        </div>

        <!-- Lose Modal -->
        <div class="modal lose" id="lose-modal" style="display:none;">
            <h2>â›” Limite de Movimentos!</h2>
            <p>VocÃª excedeu o limite. Tente uma abordagem diferente!</p>
            <div class="lose-actions">
                <button class="btn btn-accent" id="btn-undo-lose">âŸ² Desfazer Ãšltimo</button>
                <button class="btn btn-reset" id="btn-reset-lose">â†º Reiniciar</button>
                <button class="btn" id="btn-levels-lose">â˜° Fases</button>
            </div>
        </div>

        <!-- Level Select Modal -->
        <div class="modal level-select" id="level-select-modal" style="display:none;">
            <h2>ğŸ“‹ Selecione uma Fase</h2>
            <div class="level-progress" id="level-progress">
                <div class="level-progress-bar">
                    <div class="level-progress-fill" id="level-progress-fill"></div>
                </div>
                <span id="level-progress-text"></span>
            </div>
            <div class="level-grid" id="level-grid"></div>
            <div id="custom-levels-section" style="display:none;">
                <h3 class="custom-section-title">ğŸ”§ Fases Personalizadas</h3>
                <div class="level-grid" id="custom-level-grid"></div>
            </div>
            <div class="level-select-actions">
                <button class="btn" id="btn-open-editor-from-levels">ğŸ”§ Criar Fase</button>
                <button class="btn" id="btn-close-levels">âœ• Fechar</button>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="modal" id="help-modal" style="display:none;">
            <h2>ğŸ“– Regras do Jogo</h2>
            <p>Remova todas as peÃ§as do tabuleiro! Cada cor tem sua regra:</p>
            <div class="rules-grid">
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#CC2222;">â™¦</div>
                    <div class="rule-text"><strong>Vermelha</strong><br>1+ vizinhas (ignora pretas), mas nÃ£o todas.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#2244BB;">â—</div>
                    <div class="rule-text"><strong>Azul</strong><br>Remove sÃ³ com 0 vizinhas (ignora pretas).</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#1D8C1D;">â– </div>
                    <div class="rule-text"><strong>Verde</strong><br>Remove com 2+ vizinhas que formam grupo adjacente.
                    </div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#E67E22;">â¬Ÿ</div>
                    <div class="rule-text"><strong>Laranja</strong><br>Remove quando TODAS as casas adjacentes estÃ£o preenchidas.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#CCAA00;">â–²</div>
                    <div class="rule-text"><strong>Amarela</strong><br>Exatamente 3 vizinhas sem pares opostos (ignora pretas).</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#9933CC;">âœ¦</div>
                    <div class="rule-text"><strong>Roxa</strong><br>Exatamente 2 vizinhas opostas (ignora pretas).</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#F2F2F2; color:#222;">â—‰</div>
                    <div class="rule-text"><strong>Branca</strong><br>Remove sÃ³ se sua mÃ£o nÃ£o tiver peÃ§as de outras cores.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#666;">â–¬</div>
                    <div class="rule-text"><strong>Cinza</strong><br>Copia regra + modificador da Ãºltima peÃ§a removida.</div>
                </div>
                <div class="rule-row">
                    <div class="rule-swatch" style="background:#111;">â¬¢</div>
                    <div class="rule-text"><strong>Preta</strong><br>Parede imÃ³vel: remove sÃ³ quando restarem apenas pretas.</div>
                </div>
            </div>
            <div class="help-extras">
                <p>ğŸ”„ <strong>Modificadores:</strong> CÃ­rculo colorido = regra usa aquela cor como referÃªncia.</p>
                <p>ğŸ–ï¸ <strong>MÃ£o:</strong> PeÃ§as removidas vÃ£o para sua mÃ£o. Clique para recolocar.</p>
                <p>â†©ï¸ <strong>Undo:</strong> Ctrl+Z ou botÃ£o âŸ²</p>
            </div>
            <button class="btn" id="btn-close-help">âœ• Fechar</button>
        </div>

        <!-- Publish Modal -->
        <div class="modal publish-modal" id="publish-modal" style="display:none;">
            <h2>ğŸ“¤ Publicar na Comunidade</h2>
            <p id="publish-preview"></p>
            <label>Nickname (opcional)
                <input type="text" id="publish-author" maxlength="20" placeholder="AnÃ´nimo" class="editor-name-input">
            </label>
            <div class="level-select-actions">
                <button class="btn btn-accent" id="publish-confirm">Publicar</button>
                <button class="btn" id="publish-cancel">Cancelar</button>
            </div>
        </div>

        <!-- Report Modal -->
        <div class="modal" id="report-modal" style="display:none;">
            <h2>ğŸš© Denunciar mapa</h2>
            <select id="report-reason" class="editor-name-input" style="width:100%;">
                <option value="spam">Spam</option>
                <option value="inappropriate">Inapropriado</option>
                <option value="impossible">ImpossÃ­vel</option>
                <option value="other">Outro</option>
            </select>
            <label>Detalhes (opcional)
                <input type="text" id="report-detail" maxlength="120" class="editor-name-input" style="width:100%;" placeholder="Descreva rapidamente">
            </label>
            <div class="level-select-actions">
                <button class="btn btn-accent" id="report-confirm">Enviar denÃºncia</button>
                <button class="btn" id="report-cancel">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="levels.js"></script>
    <script src="game.js"></script>
    <script src="renderer.js"></script>
    <script src="solver.js"></script>
    <script src="editor.js"></script>
    <script src="tutorial_wizard.js"></script>
    <script src="api.js"></script>
    <script>
        window.COMMUNITY_ENABLED = true;
        window.COMMUNITY_API_BASE = "https://qxontsndhwvwwhvneqmc.functions.supabase.co";
    </script>
    <script src="app.js"></script>
</body>

</html>